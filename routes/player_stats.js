WITH matchesperday AS (SELECT count(*), server_adr, server_port, match_time_end FROM player WHERE name = 'Player2' GROUP BY server_adr, server_port, match_time_end)

SELECT (SELECT count(*) AS total_matches_played FROM player WHERE name = 'Player1') AS totalmatchesplayed, (SELECT count(*) FROM player WHERE name = 'Player1' and place = 0) AS totalmatcheswon, servfav.server_adr as fav_serv_adr, servfav.server_port as fav_serv_port, (SELECT count(*) FROM (SELECT DISTINCT server_adr, server_port FROM player WHERE name = 'Player2') as distserv) AS uniqueservers, (SELECT server_mode FROM (SELECT server_mode, max(matches) AS maxmatches FROM (SELECT server_mode, count(*) AS matches FROM player WHERE name = 'Player1' GROUP BY server_mode) AS servermatchcount GROUP BY server_mode) AS favmode) AS favoritemode, (SELECT max(count) FROM matchesperday) as maxmatchesperday, (SELECT avg(count) FROM matchesperday) as avgmatchesperday, (select max(match_time_end) from player where name = 'Player1') AS lastmatch, (SELECT sum(kills) FROM player where name = 'Player1') AS kills, (SELECT sum(deaths) FROM player WHERE name = 'Player1') AS deaths

FROM (SELECT server_adr, server_port, max(matches) AS maxmatches FROM (SELECT server_adr, server_port, count(*) AS matches FROM player WHERE name = 'Player1' GROUP BY server_adr, server_port) AS servermatchcount GROUP BY server_adr, server_port) AS servfav

select cur_place.place, max_place.max_place FROM (select place, server_adr, server_port, match_time_end FROM player WHERE name = 'Player1') as cur_place, (select max(place) max_place, server_adr, server_port, match_time_end FROM player GROUP BY server_adr, server_port, match_time_end) as max_place WHERE (cur_place.server_adr, cur_place.server_port, cur_place.match_time_end) = (max_place.server_adr, max_place.server_port, max_place.match_time_end)
